import "@ArgoCD/App.pkl"

app = new App {
  name = "qt-infra-fission"
  namespace = "fission"
  autoSync = true
  ignoreDifferences {
    new {
      group = ""
      kind = "Secret"
      name = "fission-webhook-certs"
      namespace = "fission"
      jsonPointers {
        "/data/ca.crt"
        "/data/tls.crt"
        "/data/tls.key"
      }
    }
    new {
      group = "admissionregistration.k8s.io"
      kind = "MutatingWebhookConfiguration"
      name = "fission-mutating-webhooks"
      jqPathExpressions {
        ".webhooks[].clientConfig.caBundle"
      }
    }
    new {
      group = "admissionregistration.k8s.io"
      kind = "ValidatingWebhookConfiguration"
      name = "fission-validating-webhooks"
      jqPathExpressions {
        ".webhooks[].clientConfig.caBundle"
      }
    }
  }
  sources {
    new {
      repoURL = "https://fission.github.io/fission-charts/"
      chart = "fission-all"
      targetRevision = "v1.22.1"
      helm {
        releaseName = "fission"
        valuesObject {
          routerServiceType = "ClusterIP"
          persistence {
            storageClass = "local-path"
          }
        }
      }
    }
    new {
      repoURL = "https://github.com/fission/fission.git"
      targetRevision = "v1.22.0"
      path = "crds/v1/"
    }
  }
}
