amends "package://pkg.pkl-lang.org/pkl-pantry/k8s.contrib.crd@4.2.1#/generate.pkl"
import "pkl:yaml"

local version = "v39.0.1"
local baseUrl =
  "https://raw.githubusercontent.com/traefik/traefik-helm-chart/\(version)/traefik/crds"
// noinspection UnresolvedElement
local kustomize: Listing<String> =
  new yaml.Parser {}.parse(read("\(baseUrl)/kustomization.yaml")).resources

source = "\(baseUrl)/kustomization.yaml"

baseApiGroup = "v1alpha1.traefik.io"
k8sImportPath = "@k8s"

sourceContents =
  new YamlRenderer {
    isStream = true
  }.renderDocument(
    kustomize
      .toList()
      .filter((item) -> item.startsWith("traefik"))
      .map((item) -> (new yaml.Parser {}.parse(read("\(baseUrl)/\(item)")) as Dynamic)),
  )

converters {}
